<div id="chat">
    <div id="hiddenEmail" style="display:none">{{userEmail}}</div>

    <div id="messages">
        {{#each messages}}
            <div class="message">
                <strong>{{this.userEmail}}:</strong> {{this.message}}
            </div>
        {{/each}}
    </div>
    <textarea id="message" placeholder="Write your message..."></textarea>
    <button id="send">Enviar</button>
</div>

<script>
    document.getElementById('send').addEventListener('click', async () => {
    const messageText = document.getElementById('message').value;
    const userEmail = document.getElementById('hiddenEmail').textContent;

    const response = await fetch('/api/messages', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user: userEmail, message: messageText })
    });

    const result = await response.json();
    if (result && result._id) {
        const messagesDiv = document.getElementById('messages');
        const newMessageDiv = document.createElement('div');
        newMessageDiv.className = 'message';
        newMessageDiv.innerHTML = `<strong>${userEmail}:</strong> ${messageText}`;
        messagesDiv.appendChild(newMessageDiv);
    }
});

</script>
